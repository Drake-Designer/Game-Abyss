{% extends "base.html" %}
{% load static %}
{% block title %}
  Set New Password â€” Game Abyss
{% endblock title %}
{% block content %}
  <!-- PAGE: Account / Reset password (confirm) -->
  <section class="container page-account-password-reset-confirm">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <div class="comp-card">
          <div class="comp-card__body p-4">
            <h2 class="comp-card__title text-center mb-4">
              <i class="fas fa-key me-2"></i>Choose a New Password
            </h2>
            {% if token_fail %}
              <div class="alert alert-danger" role="alert">This password reset link is invalid or has expired.</div>
              <div class="text-center">
                <a href="{% url 'account_reset_password' %}"
                   class="comp-button comp-button--outline">
                  <i class="fas fa-sync-alt me-2"></i>Request a new link
                </a>
              </div>
            {% else %}
              {% if form.non_field_errors %}
                <div class="alert alert-danger" role="alert" aria-live="polite">{{ form.non_field_errors }}</div>
              {% endif %}
              {# Build action URL for both uidb64 (new) and uidb36 (old) #}
              {% if uidb64 %}
                {% url 'account_reset_password_from_key' uidb64=uidb64 key=key as action_url %}
              {% else %}
                {% url 'account_reset_password_from_key' uidb36=uidb36 key=key as action_url %}
              {% endif %}
              <form method="post" action="{{ action_url }}" class="comp-form" novalidate>
                {% csrf_token %}
                <div class="mb-3">
                  <label for="id_password1" class="form-label">New Password</label>
                  <input type="password"
                         name="password1"
                         id="id_password1"
                         class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
                         autocomplete="new-password"
                         required>
                  {% if form.password1.errors %}
                    <div class="invalid-feedback" aria-live="polite">{{ form.password1.errors }}</div>
                  {% endif %}
                </div>
                <div class="mb-3">
                  <label for="id_password2" class="form-label">Confirm New Password</label>
                  <input type="password"
                         name="password2"
                         id="id_password2"
                         class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
                         autocomplete="new-password"
                         required>
                  {% if form.password2.errors %}
                    <div class="invalid-feedback" aria-live="polite">{{ form.password2.errors }}</div>
                  {% endif %}
                </div>
                <button type="submit" class="comp-button comp-button--outline w-100">
                  <i class="fas fa-check me-2"></i>Change Password
                </button>
              </form>
            {% endif %}
            <hr class="my-4">
            <div class="text-center">
              <a href="{% url 'pages:home' %}"
                 class="comp-button comp-button--outline comp-button--sm">
                <i class="fas fa-arrow-left me-2"></i>Back to Home
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- END PAGE: Account / Reset password (confirm) -->
{% endblock content %}
